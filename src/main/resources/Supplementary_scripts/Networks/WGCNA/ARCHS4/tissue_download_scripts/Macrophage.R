# R script to download selected samples
# Copy code and run on a local machine to initiate download

# Check for dependencies and install if missing
packages <- c("rhdf5")
if (length(setdiff(packages, rownames(installed.packages()))) > 0) {
    print("Install required packages")
    source("https://bioconductor.org/biocLite.R")
    biocLite("rhdf5")
}
library("rhdf5")
library("tools")

destination_file = "human_matrix_download.h5"
extracted_expression_file = "Macrophage_expression_matrix.tsv"
url = "https://s3.amazonaws.com/mssm-seq-matrix/human_matrix.h5"

# Check if gene expression file was already downloaded and check integrity, if not in current directory download file form repository
if(!file.exists(destination_file)){
    print("Downloading compressed gene expression matrix.")
    download.file(url, destination_file, quiet = FALSE)
} else{
    print("Verifying file integrity...")
    checksum = md5sum(destination_file)
    
    if(destination_file == "human_matrix_download.h5"){
        # human checksum (checksum is for latest version of ARCHS4 data)
        correct_checksum = "f78da4a1855ff20da768eed1b73508be"
    } else{
        # mouse checksum (checksum is for latest version of ARCHS4 data)
        correct_checksum = "065abb20d2b9d2661e74328de8d23eb3"
    }
    
    if(checksum != correct_checksum){
        print("Existing file looks corrupted or is out of date. Downloading compressed gene expression matrix again.")
        download.file(url, destination_file, quiet = FALSE)
    } else{
        print("Latest ARCHS4 file already exists.")
    }
}

checksum = md5sum(destination_file)
if(destination_file == "human_matrix_download.h5"){
    # human checksum (checksum is for latest version of ARCHS4 data)
    correct_checksum = "f78da4a1855ff20da768eed1b73508be"
} else{
    # mouse checksum (checksum is for latest version of ARCHS4 data)
    correct_checksum = "065abb20d2b9d2661e74328de8d23eb3"
}

if(checksum != correct_checksum){
    print("File download ran into problems. Please try to download again. The files are also available for manual download at http://maayanlab.cloud/archs4/download.html.")
} else{
    # Selected samples to be extracted
    samp = c("GSM907015","GSM907014","GSM907016","GSM907017","GSM907018","GSM907013","GSM2141240","GSM2141282","GSM1896130","GSM2141339","GSM2141364","GSM1896251","GSM1896157","GSM1896141","GSM1896252","GSM1896115","GSM1896231","GSM1896101","GSM2141291","GSM1406324","GSM1406329","GSM2141365","GSM1338804","GSM2141269","GSM1896170","GSM1406323","GSM1896222","GSM1896193","GSM2141254","GSM1896229","GSM1896201",
"GSM2141362","GSM2141329","GSM1896144","GSM1896110","GSM2141265","GSM1338806","GSM2141387","GSM2141531","GSM1896250","GSM1896123","GSM2141350","GSM2310590","GSM1896124","GSM1338810","GSM1873008","GSM1896246","GSM1896239","GSM2141263","GSM1896165","GSM1406332","GSM2141392","GSM1896258","GSM1896219","GSM2141307","GSM1632599","GSM1338809","GSM2310588","GSM1632594","GSM2141343","GSM1873014",
"GSM2141300","GSM2141271","GSM2141321","GSM2141378","GSM1896118","GSM2141385","GSM1896138","GSM1632597","GSM1896153","GSM1896136","GSM2141261","GSM1896096","GSM2141318","GSM2141317","GSM1896188","GSM1872992","GSM1896230","GSM1873003","GSM1896109","GSM1896240","GSM2141349","GSM1586130","GSM1632596","GSM1873012","GSM1896257","GSM1896223","GSM1873000","GSM1896256","GSM1896160","GSM2141334",
"GSM1896114","GSM1873010","GSM2141297","GSM1873004","GSM2141314","GSM1896148","GSM1406327","GSM1896108","GSM2141384","GSM1896095","GSM2141355","GSM1896119","GSM1896232","GSM2141389","GSM2141267","GSM1338795","GSM1896253","GSM2141294","GSM1896172","GSM2141324","GSM1338805","GSM1406321","GSM1338813","GSM1896166","GSM2141348","GSM2141390","GSM1896100","GSM2141237","GSM1896218","GSM2141299",
"GSM2141359","GSM1896097","GSM1896139","GSM1338807","GSM1406320","GSM1586131","GSM1896185","GSM2141532","GSM2141315","GSM2141346","GSM1925965","GSM1872993","GSM2141382","GSM1896209","GSM2141306","GSM1896205","GSM1896145","GSM2141256","GSM1896213","GSM2141391","GSM1338797","GSM2141296","GSM2141356","GSM2141288","GSM1896143","GSM2141249","GSM2141353","GSM2141341","GSM2141330","GSM2141361",
"GSM1896164","GSM2141372","GSM2141290","GSM1896137","GSM1896151","GSM2141366","GSM1896142","GSM1939605","GSM2141347","GSM2141246","GSM2141374","GSM1896194","GSM1896090","GSM2141336","GSM2141340","GSM2141337","GSM2141272","GSM1896126","GSM2141371","GSM2141328","GSM2141275","GSM1896093","GSM1338815","GSM2141326","GSM2141286","GSM1896177","GSM2141369","GSM2141363","GSM1925966","GSM2141274",
"GSM2141370","GSM1896259","GSM2141333","GSM2141335","GSM1896207","GSM1896163","GSM1406319","GSM1632601","GSM1896217","GSM2141398","GSM1873013","GSM2141308","GSM1896186","GSM1873007","GSM2141320","GSM1896247","GSM2141397","GSM1896162","GSM2141380","GSM1896111","GSM1896237","GSM1896112","GSM1896243","GSM1896087","GSM2141252","GSM2141316","GSM2141323","GSM1896189","GSM1896182","GSM2141245",
"GSM2141395","GSM1896149","GSM2310589","GSM2141730","GSM2141257","GSM1896212","GSM1896127","GSM2141305","GSM1896215","GSM1406325","GSM2141270","GSM2141304","GSM1338798","GSM2141734","GSM1925959","GSM1872998","GSM1896233","GSM1872999","GSM1896248","GSM1896107","GSM2141302","GSM2141399","GSM1406328","GSM1896224","GSM1873005","GSM1896088","GSM1873006","GSM2141239","GSM2141255","GSM2141388",
"GSM1896216","GSM1338808","GSM1896225","GSM2141260","GSM1896083","GSM1873016","GSM1872997","GSM1896211","GSM2141273","GSM1873002","GSM1896241","GSM2141367","GSM2141338","GSM2141285","GSM1896192","GSM1896152","GSM1896161","GSM1896089","GSM1896169","GSM1896260","GSM2141278","GSM2141377","GSM1896167","GSM1632598","GSM2141281","GSM1896125","GSM1896131","GSM1406333","GSM1338799","GSM1896082",
"GSM1896120","GSM1872996","GSM1896245","GSM2141301","GSM1896203","GSM1896116","GSM2141311","GSM2141251","GSM1896135","GSM1896154","GSM2141381","GSM2141253","GSM1896102","GSM1896106","GSM2141238","GSM1896221","GSM2141360","GSM2141287","GSM2141284","GSM2141277","GSM1896121","GSM1896086","GSM1896129","GSM1896094","GSM2141266","GSM1896202","GSM1896132","GSM1896099","GSM1896236","GSM1896146",
"GSM1632600","GSM1925960","GSM1896254","GSM2141733","GSM1338796","GSM2141386","GSM1896208","GSM1896158","GSM2141262","GSM2141396","GSM1896122","GSM1406331","GSM1896091","GSM1896191","GSM2141295","GSM1896180","GSM2141309","GSM1896156","GSM1338811","GSM1896249","GSM1896105","GSM1896214","GSM2141358","GSM1873017","GSM2141376","GSM1896104","GSM2141243","GSM2141313","GSM2141322","GSM2141298",
"GSM1896081","GSM2141241","GSM1896128","GSM2141259","GSM2141354","GSM1896210","GSM2141303","GSM1338814","GSM2141276","GSM2141344","GSM1872995","GSM2141248","GSM1896190","GSM2141280","GSM1896244","GSM2141327","GSM1896234","GSM2141383","GSM1896147","GSM1896159","GSM1896184","GSM1896150","GSM1896098","GSM2141258","GSM2141375","GSM2141368","GSM1939604","GSM1872994","GSM1925967","GSM2141283",
"GSM2141325","GSM2141292","GSM2141312","GSM1896220","GSM1896178","GSM2141731","GSM2141342","GSM1896140","GSM1896228","GSM2141293","GSM1896117","GSM2141236","GSM2141345","GSM1873001","GSM1896226","GSM1925964","GSM1896187","GSM1896255","GSM2141250","GSM1896133","GSM2141357","GSM1925961","GSM1896204","GSM1896168","GSM1896103","GSM1896084","GSM2141319","GSM1896085","GSM2141393","GSM1896183",
"GSM2141264","GSM1896242","GSM1873009","GSM2141379","GSM1925969","GSM1896238","GSM2141332","GSM2141244","GSM1896171","GSM1873015","GSM1896173","GSM2141279","GSM1896235","GSM1896181","GSM2141351","GSM1632595","GSM2141242","GSM1646963","GSM1560614","GSM2141499","GSM2141656","GSM1560855","GSM1560800","GSM2141472","GSM2141426","GSM2141439","GSM1560627","GSM1560788","GSM2141708","GSM1560814",
"GSM1387574","GSM1560622","GSM1560712","GSM2141573","GSM2141582","GSM1646962","GSM1560775","GSM1647093","GSM2141528","GSM1560630","GSM1560727","GSM1560782","GSM1647099","GSM1560749","GSM1647038","GSM1560680","GSM1560721","GSM2141509","GSM1646984","GSM2141615","GSM1560831","GSM2141684","GSM2141563","GSM2141636","GSM1560592","GSM1646996","GSM2141718","GSM1560866","GSM2141662","GSM1646973",
"GSM1647005","GSM1560580","GSM1560827","GSM2141489","GSM1646959","GSM1560668","GSM2141550","GSM2141622","GSM2141475","GSM1560640","GSM1647096","GSM1560706","GSM1560736","GSM2141566","GSM2141714","GSM1560635","GSM1560703","GSM2141514","GSM1647028","GSM1647013","GSM1647023","GSM1560799","GSM2141729","GSM1647066","GSM1646998","GSM1560792","GSM1560681","GSM1560694","GSM1560657","GSM1560683",
"GSM2141702","GSM1647110","GSM2141461","GSM2141423","GSM2141502","GSM1560700","GSM2141640","GSM1560743","GSM2141689","GSM2141572","GSM1560602","GSM1560835","GSM2141548","GSM1560642","GSM1647017","GSM2141642","GSM1647073","GSM2141577","GSM1560625","GSM2141507","GSM2141611","GSM2141655","GSM2141561","GSM1896200","GSM1560758","GSM1647003","GSM2141565","GSM1647004","GSM1560634","GSM2141540",
"GSM2141699","GSM1560702","GSM1560605","GSM1560809","GSM1896272","GSM2141469","GSM2141541","GSM2141493","GSM1560663","GSM2141713","GSM1560629","GSM2141527","GSM2141607","GSM1647006","GSM2141403","GSM2141685","GSM1560823","GSM1560581","GSM1560741","GSM2141459","GSM1560852","GSM2141594","GSM1647079","GSM2141726","GSM2141441","GSM1647095","GSM1646983","GSM1647050","GSM1560667","GSM1560750",
"GSM1647052","GSM1646974","GSM2141406","GSM2141735","GSM1560811","GSM2141588","GSM1647059","GSM2141639","GSM1560808","GSM1647002","GSM1647055","GSM2141616","GSM1560724","GSM1646976","GSM1896264","GSM2141556","GSM1560686","GSM2141495","GSM2141522","GSM2141412","GSM2141456","GSM2141433","GSM1647056","GSM2141544","GSM2141691","GSM1560665","GSM1560662","GSM1560821","GSM2141724","GSM2141436",
"GSM1560654","GSM2141428","GSM1560607","GSM1646981","GSM1560790","GSM1560753","GSM1560740","GSM2141449","GSM1560757","GSM1647024","GSM1560829","GSM1560812","GSM2141610","GSM1647088","GSM2141467","GSM2141658","GSM1560861","GSM1560641","GSM2141667","GSM1560608","GSM2141679","GSM2141510","GSM1560828","GSM1896271","GSM1560658","GSM1647034","GSM2141634","GSM2141700","GSM2141524","GSM2141505",
"GSM2141687","GSM2141664","GSM1646990","GSM1560664","GSM1560713","GSM2141568","GSM1647098","GSM1560764","GSM1647033","GSM1647112","GSM2141644","GSM2141661","GSM1647107","GSM2141564","GSM1560656","GSM1647083","GSM2141447","GSM1560784","GSM2141719","GSM2141605","GSM1560723","GSM2141460","GSM2141482","GSM1647031","GSM1560659","GSM1647047","GSM2141474","GSM1560769","GSM1647094","GSM2141694",
"GSM1560583","GSM2141477","GSM1560678","GSM1560619","GSM1560837","GSM1647020","GSM2141497","GSM1560735","GSM2141705","GSM1646965","GSM1647105","GSM1560845","GSM2141621","GSM1560726","GSM1560760","GSM1896262","GSM1896265","GSM1560785","GSM2141443","GSM1646979","GSM1647081","GSM1646975","GSM1560728","GSM1560704","GSM2141652","GSM2141584","GSM1646967","GSM1647018","GSM1560839","GSM1647077",
"GSM2141728","GSM2141620","GSM2141710","GSM2141542","GSM1560864","GSM2141488","GSM1560751","GSM1896195","GSM1560717","GSM1647054","GSM2141721","GSM2141445","GSM1560673","GSM1560584","GSM2141590","GSM2141738","GSM1560690","GSM2141665","GSM1560698","GSM2141421","GSM2141454","GSM2141709","GSM1560600","GSM1647049","GSM2141435","GSM1560708","GSM2141637","GSM2141683","GSM1647091","GSM1560794",
"GSM1560776","GSM1647008","GSM1560597","GSM1560772","GSM2141442","GSM1896175","GSM1560626","GSM1560648","GSM2141501","GSM1560836","GSM1560838","GSM2141681","GSM1647061","GSM2141411","GSM1560672","GSM1647032","GSM1647090","GSM2141670","GSM2141680","GSM1560691","GSM1560830","GSM1560797","GSM1560620","GSM1647021","GSM1560679","GSM1647015","GSM2141546","GSM1896278","GSM1896196","GSM2141410",
"GSM1560582","GSM2141638","GSM1560771","GSM1560588","GSM2141533","GSM1560789","GSM2141484","GSM2141725","GSM1560666","GSM1560798","GSM2141704","GSM2141420","GSM2141558","GSM1560731","GSM1647111","GSM2141452","GSM1560744","GSM1560603","GSM1896274","GSM1560671","GSM2141539","GSM2141674","GSM1560722","GSM1560770","GSM2141555","GSM1647007","GSM2141516","GSM2141537","GSM2141492","GSM2141663",
"GSM2141625","GSM2141508","GSM2141613","GSM2141707","GSM2141673","GSM2141703","GSM1560857","GSM1560637","GSM2141706","GSM1560833","GSM2141466","GSM2141659","GSM1560616","GSM1560593","GSM2141409","GSM1560590","GSM1560767","GSM2141425","GSM1647104","GSM1647040","GSM2141513","GSM1646993","GSM2141529","GSM2141405","GSM2141511","GSM2141601","GSM1560714","GSM1896199","GSM2141401","GSM1647060",
"GSM1560825","GSM2141506","GSM1560738","GSM2141549","GSM2141483","GSM2141535","GSM1647051","GSM1560643","GSM2141596","GSM1647102","GSM2141553","GSM2141517","GSM1560819","GSM1647011","GSM1647101","GSM1560843","GSM2141530","GSM1646991","GSM2141415","GSM1647000","GSM1560669","GSM2141491","GSM2141606","GSM1560746","GSM1646972","GSM2141471","GSM1560801","GSM1560710","GSM2141424","GSM2141600",
"GSM2141641","GSM2141701","GSM1646980","GSM1560773","GSM1560585","GSM1896277","GSM2141677","GSM2141434","GSM2141712","GSM1896174","GSM1560795","GSM2141657","GSM1560820","GSM1646987","GSM1560599","GSM1647001","GSM1647103","GSM1560587","GSM2141503","GSM1560766","GSM2141578","GSM2141624","GSM2141678","GSM2141580","GSM1896276","GSM2141557","GSM2141589","GSM2141575","GSM2141462","GSM1647084",
"GSM2141569","GSM1560796","GSM1560793","GSM2141400","GSM1560778","GSM2141416","GSM1560594","GSM1560615","GSM1647109","GSM1560824","GSM2141715","GSM1646977","GSM1647082","GSM1647068","GSM1646982","GSM1560752","GSM1560858","GSM2141646","GSM1560725","GSM1560817","GSM2141579","GSM2141451","GSM1647067","GSM2141538","GSM1560613","GSM1647070","GSM2141583","GSM1560651","GSM2141407","GSM1560677",
"GSM1560834","GSM2141478","GSM1647097","GSM1560720","GSM1560754","GSM1647106","GSM1560623","GSM1560601","GSM2141628","GSM1647062","GSM2141444","GSM1560610","GSM2141574","GSM2141669","GSM2141666","GSM2141587","GSM1647035","GSM1560688","GSM2141635","GSM2141585","GSM2141521","GSM1647080","GSM1646964","GSM2141648","GSM1560660","GSM2141490","GSM1647026","GSM2141717","GSM2141597","GSM1560578",
"GSM2141632","GSM1560867","GSM1560591","GSM1646995","GSM2141602","GSM1560853","GSM1560595","GSM1560807","GSM1560598","GSM1646997","GSM2141722","GSM1560612","GSM1647019","GSM1560596","GSM1560791","GSM1560604","GSM1560815","GSM1647022","GSM1560755","GSM2141630","GSM2141649","GSM1560762","GSM1647046","GSM1560734","GSM1560780","GSM2141567","GSM2141480","GSM1560842","GSM1560617","GSM1387573",
"GSM1560692","GSM1560705","GSM1896198","GSM2141500","GSM1560632","GSM1896197","GSM1560850","GSM1646994","GSM1646988","GSM1647072","GSM2141515","GSM2141512","GSM1646960","GSM1560865","GSM2141650","GSM1560844","GSM1560781","GSM1560606","GSM2141470","GSM1647041","GSM1647025","GSM2141675","GSM2141523","GSM2141599","GSM2141468","GSM1560639","GSM2141618","GSM2141688","GSM1560849","GSM2141654",
"GSM1646961","GSM1560687","GSM1646957","GSM1560579","GSM1560739","GSM2141536","GSM1560685","GSM1560747","GSM1560826","GSM1560732","GSM2141727","GSM1560854","GSM2141690","GSM2141595","GSM1646978","GSM2141695","GSM1560586","GSM1647045","GSM1896270","GSM2141571","GSM1560624","GSM1896261","GSM2141518","GSM1647016","GSM1560860","GSM2141723","GSM2141554","GSM1560661","GSM1560806","GSM2141592",
"GSM2141429","GSM1560589","GSM2141698","GSM2141653","GSM1647030","GSM2141696","GSM1896273","GSM2141732","GSM2141545","GSM1647064","GSM1646970","GSM1647078","GSM1560756","GSM2141604","GSM1647076","GSM1560649","GSM2141559","GSM2141672","GSM1560868","GSM1646985","GSM2141716","GSM2141543","GSM2141692","GSM2141651","GSM2141464","GSM1647042","GSM1896268","GSM1560777","GSM1560674","GSM1560621",
"GSM1560695","GSM2141591","GSM1560718","GSM2141609","GSM2141534","GSM2141437","GSM1646969","GSM1560804","GSM1647069","GSM2141660","GSM2141402","GSM1560847","GSM1560682","GSM2141668","GSM2141457","GSM2141494","GSM2141581","GSM2141463","GSM1896263","GSM1560684","GSM1560805","GSM2141438","GSM1560618","GSM1896176","GSM2141612","GSM1647027","GSM1560730","GSM1560611","GSM1560711","GSM1560650",
"GSM1646992","GSM2141520","GSM1560848","GSM2141486","GSM1560716","GSM1560813","GSM1560803","GSM2141481","GSM2141419","GSM2141504","GSM1560787","GSM2141711","GSM1647058","GSM1560715","GSM1560742","GSM2141417","GSM2141643","GSM2141631","GSM2141608","GSM2141413","GSM1560636","GSM2141686","GSM1647085","GSM1646999","GSM1647065","GSM1560846","GSM1560707","GSM2141422","GSM1560655","GSM2141487",
"GSM2141671","GSM2141697","GSM2141496","GSM2141737","GSM2141570","GSM1896275","GSM1560733","GSM1560851","GSM1560748","GSM2141647","GSM2141627","GSM1560675","GSM1560802","GSM2141586","GSM2141576","GSM1560765","GSM1647012","GSM1560816","GSM1560644","GSM1560633","GSM2141619","GSM2141476","GSM1560759","GSM2141479","GSM2141455","GSM1560818","GSM2141593","GSM1560841","GSM1560653","GSM1896267",
"GSM1560783","GSM2141450","GSM1560670","GSM1647037","GSM2141408","GSM1560697","GSM1647089","GSM1646971","GSM2141598","GSM2141498","GSM1560652","GSM1560779","GSM2141676","GSM1560761","GSM1560786","GSM1560863","GSM2141629","GSM1560810","GSM2141736","GSM1560628","GSM2141562","GSM1560763","GSM1647092","GSM1560647","GSM1647014","GSM1560856","GSM1560699","GSM2141473","GSM1560696","GSM1560737",
"GSM1560768","GSM2141623","GSM2141720","GSM1560609","GSM2141418","GSM2141525","GSM1560869","GSM1560676","GSM1647044","GSM2141440","GSM2141645","GSM2141633","GSM1560631","GSM2141614","GSM1646968","GSM1646989","GSM1560729","GSM1560745","GSM2141626","GSM1560638","GSM2141519","GSM1647086","GSM2141404","GSM2141432","GSM1387572","GSM2141526","GSM2141448","GSM1560859","GSM1647057","GSM2141414",
"GSM1560774","GSM1647108","GSM2141446","GSM1647029","GSM1560646","GSM1647043","GSM1646958","GSM1647100","GSM1560701","GSM1647039","GSM2141552","GSM1560862","GSM1560709","GSM2141682","GSM1387575","GSM2141430","GSM2141551","GSM2141603","GSM1560689","GSM1646986","GSM1560840","GSM1647010","GSM1560822","GSM1646966","GSM1647063","GSM2141465","GSM1560832","GSM2141547","GSM2141693","GSM1647075",
"GSM1560693","GSM2141427","GSM1560719","GSM1896266","GSM2141560","GSM2141458","GSM2141485","GSM1896269","GSM1647053","GSM1647036","GSM1647087","GSM1647074","GSM2141431","GSM1560645","GSM1647071","GSM2141617","GSM1647048","GSM2141453","GSM1338794","GSM1925968","GSM1338812","GSM1873011","GSM1896206","GSM1896092","GSM1896155","GSM1896134","GSM1896227","GSM1896113","GSM1896179","GSM2141310",
"GSM2141373","GSM2141394","GSM2141247","GSM2141331","GSM2141289","GSM2141268","GSM2141352","GSM1937832","GSM1937833","GSM1937830","GSM1937831","GSM1937836","GSM1937837","GSM1937835","GSM1937838","GSM1937839","GSM1937850","GSM1937851","GSM1937852","GSM1937853","GSM1937854","GSM1937855","GSM1937856","GSM1937857","GSM1937858","GSM1937859","GSM1937827","GSM1937826","GSM1937829","GSM1937828",
"GSM1937861","GSM1937860","GSM1937847","GSM1937846","GSM1937845","GSM1937844","GSM1937843","GSM1937842","GSM1937841","GSM1937840","GSM1937849","GSM1937848","GSM1937834","GSM2445663","GSM2445656","GSM2445659","GSM2445657","GSM2445658","GSM2445660","GSM2445662","GSM2445664","GSM2445661","GSM2576749","GSM2576756","GSM2576755","GSM2576753","GSM2576773","GSM2576754","GSM2576750","GSM2576774",
"GSM2576752","GSM2576751","GSM2135456","GSM2135457","GSM2135458","GSM2135459","GSM2135460","GSM2135461","GSM2135462","GSM2135463","GSM2135464","GSM2135465","GSM2135466","GSM2135467","GSM2135468","GSM2135477","GSM2135478","GSM2135479","GSM2135480","GSM2135481","GSM2135482","GSM2256657","GSM2256658","GSM2256659","GSM2256660","GSM2256661","GSM2256662","GSM2256663","GSM2256664","GSM2592814",
"GSM2592815","GSM2592816","GSM2592817","GSM2592818","GSM2592819","GSM2592820","GSM2592821","GSM2592822","GSM2592823","GSM2592824","GSM2592825","GSM2592826","GSM2592827","GSM2592828","GSM2592829","GSM2679941","GSM2679942","GSM2679943","GSM2679944","GSM2679945","GSM2679946","GSM2679947","GSM2679948","GSM2679949","GSM2679950","GSM2679951","GSM2679952","GSM2679953","GSM2679954","GSM2679955",
"GSM2679956","GSM2679957","GSM2679958","GSM2679959","GSM2679960","GSM2679961","GSM2679962","GSM2679963","GSM2679964","GSM2667006","GSM2667007","GSM2667008","GSM2667009","GSM2667010","GSM2667011","GSM2667012","GSM2667013","GSM2667014","GSM2667015","GSM2667016","GSM2667017","GSM2667018","GSM2667019","GSM2667020","GSM2667021","GSM2667022","GSM2667023","GSM2667024","GSM2667025","GSM2667026",
"GSM2667027","GSM2667028","GSM2667029","GSM2667030","GSM2667031","GSM2667032","GSM2667033","GSM2667034","GSM2667035","GSM2667036","GSM2667037","GSM2667038","GSM2667039","GSM2667040","GSM2667041","GSM2667042","GSM2667043","GSM2667044","GSM2667045","GSM2717384","GSM2717385","GSM2717386","GSM2717387","GSM2717388","GSM2717389","GSM2717390","GSM2717391","GSM2803868","GSM2803869","GSM2803870",
"GSM2803871","GSM2803872","GSM2803873","GSM2084374","GSM2084375","GSM2084376","GSM2084377","GSM2084378","GSM2084379","GSM2084380","GSM2084381","GSM2084382","GSM2084383","GSM2084384","GSM2084385","GSM2084386","GSM2084387","GSM2084388","GSM2084389","GSM2084390","GSM2084391","GSM2084392","GSM2084393","GSM2084394","GSM2084395","GSM2084396","GSM2084397","GSM2084398","GSM2084399","GSM2084400",
"GSM2084449","GSM2084450","GSM2084451","GSM2084452","GSM2084453","GSM2084454","GSM2084455","GSM2084456","GSM2084457","GSM2084458","GSM2084459","GSM2084460","GSM2084461","GSM2084462","GSM2084463","GSM2084464","GSM2084465","GSM2084466","GSM2104418","GSM2104419","GSM2104420","GSM2104421","GSM2104422","GSM2104423","GSM2104424","GSM2104425","GSM2104426","GSM2104427","GSM2104428","GSM2104429",
"GSM2228762","GSM2228763","GSM2228764","GSM2228765","GSM2228766","GSM2228767","GSM2228768","GSM2228769","GSM2228770","GSM2228771","GSM2228772","GSM2228773","GSM2228774","GSM2228775","GSM2228776","GSM2228777","GSM2228778","GSM2228779","GSM2228780","GSM2228781","GSM2228782","GSM2228783","GSM2228784","GSM2228785","GSM2228786","GSM2228787","GSM2228788","GSM2228789","GSM2228790","GSM2228791",
"GSM2228792","GSM2228793","GSM2228794","GSM2228795","GSM2228796","GSM2228797","GSM2228798","GSM2228799","GSM2228800","GSM2228801","GSM2228802","GSM2228803","GSM2320004","GSM2320005","GSM2320006","GSM2320007","GSM2431608","GSM2431609","GSM2431610","GSM2431611","GSM2431612","GSM2431613","GSM2431614","GSM2431615","GSM2431616","GSM2431617","GSM2431618","GSM2431619","GSM2431620","GSM2431621",
"GSM2431622","GSM2431623","GSM2431624","GSM2431625","GSM2431626","GSM2431627","GSM2431628","GSM2431629","GSM2431630","GSM2431631","GSM2431632","GSM2431633","GSM2431634","GSM2431635","GSM2431636","GSM2431637","GSM2431638","GSM2431639","GSM2431640","GSM2431641","GSM2431642","GSM2431643","GSM2431644","GSM2431645","GSM2431646","GSM2431647","GSM2431648","GSM2431649","GSM2431650","GSM2431651",
"GSM2431652","GSM2431653","GSM2431654","GSM2431655","GSM2431656","GSM2431657","GSM2431658","GSM2431659","GSM2431660","GSM2431661","GSM2431662","GSM2431663","GSM2431664","GSM2431665","GSM2431666","GSM2431667","GSM2431668","GSM2431669","GSM2431670","GSM2431671","GSM2431672","GSM2431673","GSM2431674","GSM2431675","GSM2431676","GSM2431677","GSM2431678","GSM2431679","GSM2431680","GSM2431681",
"GSM2431682","GSM2431683","GSM2431684","GSM2431685","GSM2431686","GSM2431687","GSM2431688","GSM2431689","GSM2431690","GSM2486334","GSM2471163","GSM2471164","GSM2471165","GSM2471166","GSM2471167","GSM2791283","GSM2791284","GSM2791285","GSM2791286","GSM2791287","GSM2791288","GSM2791289","GSM2791290","GSM2791291","GSM2791292","GSM2791293","GSM2791294","GSM2791295","GSM2791296","GSM2791297",
"GSM2791298","GSM2791299","GSM2791300","GSM2791301","GSM2791302","GSM2791303","GSM2791304","GSM2791305","GSM2791306","GSM2791307","GSM2791308","GSM2791309","GSM2791310","GSM2791311","GSM2791312","GSM2791313","GSM2791314","GSM2791315","GSM2791316","GSM2791317","GSM2791318","GSM2791319","GSM2791320","GSM2791321","GSM2791322","GSM2791323","GSM2791324","GSM2791325","GSM2791326","GSM2791327",
"GSM2791328","GSM2791329","GSM2791330","GSM2791331","GSM2791332","GSM2791333","GSM2791334","GSM2791335","GSM2791336","GSM2791337","GSM2791338","GSM2791339","GSM2791340","GSM2791341","GSM2791342","GSM2791343","GSM2791344","GSM2791345","GSM2791346","GSM2791347","GSM2791348","GSM2791349","GSM2791350","GSM2791351","GSM2791352","GSM2791353","GSM2791354","GSM3019395","GSM3019396","GSM3019400",
"GSM3019401","GSM3019402","GSM2778746","GSM2778747","GSM2778749","GSM2778750","GSM2778751","GSM2778752","GSM2778753","GSM2778754","GSM2778755","GSM2778756","GSM2778757","GSM2024759","GSM2024762","GSM2024763","GSM2024764","GSM2024766","GSM2024767","GSM2024768","GSM2024770","GSM2024771","GSM2024774","GSM2596469","GSM2596471","GSM2596473","GSM2596475","GSM2596476","GSM2596479","GSM2596483",
"GSM2596485","GSM2596486","GSM2596488","GSM2596491","GSM3162631","")

    # Retrieve information from compressed data
    samples = h5read(destination_file, "meta/Sample_geo_accession")
    tissue = h5read(destination_file, "meta/Sample_source_name_ch1")
    genes = h5read(destination_file, "meta/genes")

    # Identify columns to be extracted
    sample_locations = which(samples %in% samp)

    # extract gene expression from compressed data
    expression = h5read(destination_file, "data/expression", index=list(1:length(genes), sample_locations))
    H5close()
    rownames(expression) = genes
    colnames(expression) = samples[sample_locations]

    # Print file
    write.table(expression, file=extracted_expression_file, sep="\t", quote=FALSE)
    print(paste0("Expression file was created at ", getwd(), "/", extracted_expression_file))
}
