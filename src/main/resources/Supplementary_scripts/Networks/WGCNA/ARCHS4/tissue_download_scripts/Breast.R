# R script to download selected samples
# Copy code and run on a local machine to initiate download

# Check for dependencies and install if missing
packages <- c("rhdf5")
if (length(setdiff(packages, rownames(installed.packages()))) > 0) {
    print("Install required packages")
    source("https://bioconductor.org/biocLite.R")
    biocLite("rhdf5")
}
library("rhdf5")
library("tools")

destination_file = "human_matrix_download.h5"
extracted_expression_file = "Breast_expression_matrix.tsv"
url = "https://s3.amazonaws.com/mssm-seq-matrix/human_matrix.h5"

# Check if gene expression file was already downloaded and check integrity, if not in current directory download file form repository
if(!file.exists(destination_file)){
    print("Downloading compressed gene expression matrix.")
    download.file(url, destination_file, quiet = FALSE)
} else{
    print("Verifying file integrity...")
    checksum = md5sum(destination_file)
    
    if(destination_file == "human_matrix_download.h5"){
        # human checksum (checksum is for latest version of ARCHS4 data)
        correct_checksum = "f78da4a1855ff20da768eed1b73508be"
    } else{
        # mouse checksum (checksum is for latest version of ARCHS4 data)
        correct_checksum = "065abb20d2b9d2661e74328de8d23eb3"
    }
    
    if(checksum != correct_checksum){
        print("Existing file looks corrupted or is out of date. Downloading compressed gene expression matrix again.")
        download.file(url, destination_file, quiet = FALSE)
    } else{
        print("Latest ARCHS4 file already exists.")
    }
}

checksum = md5sum(destination_file)
if(destination_file == "human_matrix_download.h5"){
    # human checksum (checksum is for latest version of ARCHS4 data)
    correct_checksum = "f78da4a1855ff20da768eed1b73508be"
} else{
    # mouse checksum (checksum is for latest version of ARCHS4 data)
    correct_checksum = "065abb20d2b9d2661e74328de8d23eb3"
}

if(checksum != correct_checksum){
    print("File download ran into problems. Please try to download again. The files are also available for manual download at http://maayanlab.cloud/archs4/download.html.")
} else{
    # Selected samples to be extracted
    samp = c("GSM742940","GSM1100210","GSM1239141","GSM1239140","GSM1113310","GSM1171525","GSM1100206","GSM830454","GSM1171527","GSM830453","GSM1239123","GSM937160","GSM942209","GSM1113308","GSM1239136","GSM1113301","GSM1239135","GSM1239119","GSM1239126","GSM1239124","GSM1113307","GSM1239127","GSM1239133","GSM1113302","GSM1100205","GSM1239137","GSM1239134","GSM1113298","GSM1113311","GSM830455","GSM1239131",
"GSM1239120","GSM942211","GSM1239130","GSM1113305","GSM1239132","GSM1239142","GSM1239138","GSM937168","GSM1100209","GSM1113299","GSM1113309","GSM1239129","GSM1239139","GSM830456","GSM937164","GSM937163","GSM937162","GSM1239128","GSM1113304","GSM1154039","GSM1239143","GSM937167","GSM937166","GSM937170","GSM1239121","GSM1113306","GSM1113303","GSM830457","GSM1239118","GSM1239122",
"GSM1239144","GSM1239125","GSM942210","GSM1154040","GSM1113300","GSM1401701","GSM1556181","GSM1401724","GSM1401678","GSM1431879","GSM1897337","GSM1897288","GSM1401784","GSM1401710","GSM1537306","GSM1354575","GSM1401743","GSM1401762","GSM1401726","GSM1695877","GSM1354572","GSM1897290","GSM1401759","GSM1533420","GSM1897277","GSM1354563","GSM1431880","GSM1401742","GSM1401755","GSM1401757",
"GSM1401785","GSM1608264","GSM1897348","GSM1261034","GSM1847260","GSM1401730","GSM1348545","GSM1897329","GSM1401796","GSM1693179","GSM1401767","GSM1693178","GSM1417178","GSM1401708","GSM1897333","GSM1693176","GSM1503445","GSM1401738","GSM1300629","GSM1897297","GSM1294983","GSM1533418","GSM1399413","GSM1556182","GSM1553457","GSM1897301","GSM1401741","GSM1897289","GSM1401653","GSM1348551",
"GSM1401671","GSM1608265","GSM1874955","GSM1401811","GSM1401721","GSM1695872","GSM1829774","GSM1401806","GSM1273493","GSM1462977","GSM1891972","GSM1897346","GSM1401682","GSM1348549","GSM1369969","GSM2133925","GSM1354577","GSM1695879","GSM1401771","GSM1401773","GSM1897350","GSM1401663","GSM1897295","GSM1897286","GSM1317636","GSM1401686","GSM1294967","GSM1401732","GSM1897330","GSM1608267",
"GSM1354580","GSM1897338","GSM1300631","GSM1661528","GSM1401685","GSM1897307","GSM1897328","GSM1401795","GSM1317641","GSM1294986","GSM2133924","GSM1401695","GSM1369968","GSM1401763","GSM1354579","GSM1897293","GSM1462976","GSM1817677","GSM1401665","GSM1401705","GSM1695871","GSM1401706","GSM1503442","GSM2133921","GSM1503435","GSM1401694","GSM1300628","GSM1401667","GSM1348550","GSM1533417",
"GSM1401722","GSM1354556","GSM1897276","GSM1401718","GSM1354578","GSM1354557","GSM1401812","GSM1314288","GSM1401697","GSM2218825","GSM1300627","GSM1348546","GSM1401674","GSM1300632","GSM1942105","GSM1891970","GSM1294972","GSM1661531","GSM1897296","GSM1897312","GSM1401789","GSM1829776","GSM1401734","GSM1891971","GSM1695873","GSM1401699","GSM1401800","GSM1401691","GSM1401657","GSM1354573",
"GSM1897320","GSM1829775","GSM1533423","GSM1300622","GSM1401662","GSM1897334","GSM2055792","GSM1401680","GSM1300630","GSM1897344","GSM1431878","GSM1348548","GSM1462972","GSM1897354","GSM1354571","GSM1401775","GSM1354560","GSM1354552","GSM1348547","GSM1897302","GSM1874957","GSM1401815","GSM1401740","GSM1317639","GSM1401737","GSM1874953","GSM1314287","GSM1401764","GSM1847261","GSM1401729",
"GSM1401693","GSM1462973","GSM1897299","GSM1666033","GSM1431876","GSM1401766","GSM1401783","GSM1294984","GSM1401669","GSM1503437","GSM1829778","GSM1401654","GSM1897327","GSM1874956","GSM1401703","GSM1401700","GSM1553460","GSM1401652","GSM1897281","GSM1537305","GSM1401670","GSM1897300","GSM1693177","GSM1897326","GSM1401770","GSM1897317","GSM1897316","GSM1354570","GSM1942107","GSM1533419",
"GSM1401684","GSM1348541","GSM1300623","GSM1897336","GSM1897284","GSM1401704","GSM1942104","GSM1401690","GSM1417177","GSM1354554","GSM1273497","GSM1401809","GSM1897342","GSM1348544","GSM1462974","GSM1294969","GSM1897314","GSM1354581","GSM1942109","GSM1294045","GSM1401761","GSM1354562","GSM1897279","GSM1401804","GSM1401713","GSM1401696","GSM2133922","GSM1401676","GSM1294044","GSM1354555",
"GSM1533421","GSM1897308","GSM1401778","GSM1666032","GSM1354559","GSM1401672","GSM1300633","GSM1897306","GSM1533415","GSM1401698","GSM1661530","GSM1399412","GSM1401808","GSM1503441","GSM1401782","GSM1401777","GSM1300624","GSM1608266","GSM1401758","GSM1354561","GSM1533422","GSM1401745","GSM1401735","GSM1401769","GSM1401715","GSM1897340","GSM1399414","GSM1608261","GSM1294968","GSM1317637",
"GSM1875306","GSM1556183","GSM1897310","GSM1503443","GSM1897345","GSM1897355","GSM1294988","GSM1354558","GSM1431877","GSM1553458","GSM1897351","GSM1401649","GSM1401787","GSM1897347","GSM1897280","GSM1273498","GSM1897323","GSM1401754","GSM1401739","GSM2133928","GSM1553455","GSM1897341","GSM1369970","GSM1401753","GSM1897319","GSM1401707","GSM1401683","GSM1695878","GSM1401751","GSM1273499",
"GSM1897287","GSM1401658","GSM1401749","GSM1897332","GSM1897278","GSM1401720","GSM1897356","GSM1537307","GSM1401675","GSM1399411","GSM1401716","GSM1897321","GSM1897331","GSM1401688","GSM2133918","GSM1401801","GSM1608262","GSM1897322","GSM1817678","GSM1897343","GSM1401781","GSM1431881","GSM1829773","GSM1556177","GSM1897309","GSM1695876","GSM1401805","GSM1401728","GSM1401650","GSM1369967",
"GSM1354565","GSM1401655","GSM1401673","GSM1401717","GSM1503434","GSM1897311","GSM1431874","GSM1556186","GSM1897303","GSM1556185","GSM1401772","GSM1401659","GSM1897349","GSM1847259","GSM1401768","GSM1401711","GSM1897324","GSM1401648","GSM1462975","GSM1294981","GSM1401733","GSM1695875","GSM1431870","GSM1503440","GSM1294970","GSM1847262","GSM1401651","GSM1317638","GSM1897353","GSM1401803",
"GSM1897313","GSM1431871","GSM1294042","GSM1401797","GSM1401709","GSM1273494","GSM1401799","GSM1556184","GSM1897292","GSM1401760","GSM1401756","GSM1897352","GSM1401727","GSM1897339","GSM1401677","GSM1294971","GSM1261033","GSM1317640","GSM1695870","GSM1401802","GSM1829772","GSM1897294","GSM1401687","GSM1817676","GSM1897298","GSM1354567","GSM1401712","GSM1503433","GSM1300626","GSM1695874",
"GSM1401774","GSM1300634","GSM1354566","GSM1556179","GSM1401776","GSM2055799","GSM1431873","GSM1401746","GSM1533416","GSM1401664","GSM1417179","GSM1874952","GSM1401788","GSM1401731","GSM2133920","GSM1553456","GSM1608263","GSM1431872","GSM1401798","GSM1897335","GSM1829777","GSM1401679","GSM1348552","GSM1401668","GSM1300635","GSM1401750","GSM1401813","GSM1273495","GSM1942108","GSM1401714",
"GSM1556178","GSM1354553","GSM1401747","GSM1401725","GSM1354568","GSM1273492","GSM1553459","GSM1503439","GSM1401666","GSM1401661","GSM2133923","GSM1401692","GSM1401689","GSM1354574","GSM1401810","GSM1348542","GSM1401814","GSM1300625","GSM1897285","GSM1401752","GSM1503438","GSM1942106","GSM1897282","GSM1897291","GSM1401779","GSM2133919","GSM2133927","GSM1661529","GSM1354576","GSM1897318",
"GSM1897315","GSM1294982","GSM1294987","GSM1503436","GSM1401719","GSM1875302","GSM2133926","GSM1897305","GSM1709525","GSM1709578","GSM1662556","GSM1709559","GSM2112769","GSM2112723","GSM1709575","GSM2112783","GSM1709589","GSM2112754","GSM2112734","GSM2112743","GSM2112790","GSM1916002","GSM2112764","GSM2112735","GSM2112770","GSM2112750","GSM2112794","GSM2112761","GSM1709566","GSM2112751",
"GSM1709588","GSM2112736","GSM2112720","GSM1709516","GSM2112725","GSM1709571","GSM2112776","GSM1662536","GSM2112733","GSM2112762","GSM2112786","GSM2112774","GSM1709551","GSM1916011","GSM2112746","GSM2112772","GSM1916000","GSM1709549","GSM2112778","GSM1662537","GSM1709568","GSM2112744","GSM2112788","GSM2112789","GSM2112753","GSM2112724","GSM1916007","GSM2112730","GSM2112765","GSM2112727",
"GSM2112742","GSM2112787","GSM1709563","GSM2112741","GSM2112726","GSM1709558","GSM1916010","GSM1662551","GSM1709552","GSM1709584","GSM1709565","GSM1915998","GSM1662543","GSM1709538","GSM2112793","GSM2112745","GSM1709530","GSM1709524","GSM2112721","GSM1709585","GSM2112722","GSM1709569","GSM1709539","GSM2112785","GSM2112748","GSM2112749","GSM1709555","GSM2112775","GSM1662541","GSM1916005",
"GSM2112768","GSM2112729","GSM1709517","GSM2112752","GSM1916001","GSM2112758","GSM1709540","GSM2112782","GSM1864032","GSM2112760","GSM2112763","GSM1709562","GSM1709564","GSM1709572","GSM1662539","GSM2112739","GSM1916008","GSM2112780","GSM1709547","GSM2112757","GSM1915999","GSM2112759","GSM2112781","GSM1662554","GSM2112719","GSM1709519","GSM1709520","GSM2112738","GSM2112732","GSM1916012",
"GSM1864035","GSM1709567","GSM1709518","GSM2112771","GSM2112773","GSM1908527","GSM1709577","GSM1709535","GSM1662555","GSM1709573","GSM2112766","GSM1709580","GSM2112740","GSM1864039","GSM1709570","GSM1709546","GSM1662553","GSM1908526","GSM2112767","GSM2112728","GSM2112756","GSM1916004","GSM1908528","GSM1709544","GSM1709532","GSM1709541","GSM1662538","GSM1864036","GSM1916003","GSM1662542",
"GSM1916006","GSM1662550","GSM1709561","GSM2112755","GSM1709553","GSM1709534","GSM1916013","GSM2112792","GSM1709521","GSM1537129","GSM1662548","GSM2112784","GSM1662552","GSM1709542","GSM2112779","GSM1709522","GSM1662557","GSM1662549","GSM1908529","GSM2112791","GSM1662546","GSM1662535","GSM1709560","GSM1709583","GSM1662544","GSM1916009","GSM1709515","GSM1662545","GSM1709586","GSM1709528",
"GSM1709554","GSM1709523","GSM2112747","GSM1662534","GSM2112737","GSM1709557","GSM2112731","GSM1864034","GSM1709550","GSM1709527","GSM1864037","GSM1709536","GSM1864033","GSM1709529","GSM2112777","GSM1662540","GSM1709587","GSM1709581","GSM1709531","GSM1709543","GSM1709548","GSM1709556","GSM1709574","GSM1709533","GSM1864038","GSM1709526","GSM1709576","GSM1537130","GSM1709537","GSM1709579",
"GSM1709545","GSM1261035","GSM1273496","GSM1294043","GSM1294985","GSM1300621","GSM1348543","GSM1354564","GSM1354569","GSM1399410","GSM1401736","GSM1401744","GSM1401748","GSM1401780","GSM1401786","GSM1401681","GSM1401765","GSM1401702","GSM1401656","GSM1401723","GSM1401660","GSM1401807","GSM1431875","GSM1503444","GSM1533414","GSM1556180","GSM1829779","GSM1874954","GSM1897283","GSM1897325",
"GSM1897275","GSM1897304","GSM2133917","GSM2393524","GSM2393523","GSM1899709","GSM1899750","GSM1899751","GSM1899752","GSM1899753","GSM1899743","GSM1899742","GSM1899740","GSM1899747","GSM1899746","GSM1899745","GSM1899744","GSM1899749","GSM1899748","GSM2443099","GSM2443098","GSM2443097","GSM2443096","GSM2443095","GSM2443094","GSM2443093","GSM2443092","GSM1899725","GSM1899724","GSM1899736",
"GSM1899737","GSM1899734","GSM1899735","GSM1899732","GSM1899733","GSM1899730","GSM1899738","GSM1899739","GSM1908562","GSM1908563","GSM1908560","GSM1908561","GSM1908566","GSM1908567","GSM1908564","GSM1908565","GSM1899727","GSM1899726","GSM1899721","GSM1899720","GSM1899723","GSM1899722","GSM1899729","GSM1899728","GSM2443101","GSM2443100","GSM2443103","GSM2443102","GSM1899741","GSM1899718",
"GSM1899719","GSM1899710","GSM1899711","GSM1899712","GSM1899713","GSM1899714","GSM1899715","GSM1899716","GSM1899717","GSM1908548","GSM1908549","GSM1908544","GSM1908546","GSM1908547","GSM1908540","GSM1908541","GSM1908542","GSM1899708","GSM1899707","GSM1908553","GSM1908552","GSM1908551","GSM1908550","GSM1908557","GSM1908556","GSM1908555","GSM1908554","GSM1908559","GSM1908558","GSM1899731",
"GSM1908539","GSM1908538","GSM1908545","GSM1908543","GSM2343212","GSM2257525","GSM2257526","GSM2257524","GSM2257523","GSM2343705","GSM2343701","GSM1370587","GSM1370584","GSM1370586","GSM1370585","GSM1581605","GSM1581610","GSM1581609","GSM1581606","GSM1581607","GSM1581608","GSM1726618","GSM1726615","GSM1726613","GSM1726616","GSM1915702","GSM1915700","GSM1915701","GSM1915699","GSM1915703",
"GSM1915698","GSM1920179","GSM1920180","GSM1920181","GSM2098749","GSM2098743","GSM2098737","GSM2098715","GSM2098747","GSM2098642","GSM2098735","GSM2098748","GSM2098712","GSM2098681","GSM2098683","GSM2098727","GSM2098676","GSM2098719","GSM2098632","GSM2098695","GSM2098730","GSM2098750","GSM2098671","GSM2098729","GSM2098641","GSM2098667","GSM2098710","GSM2098745","GSM2098740","GSM2098744",
"GSM2098666","GSM2098728","GSM2098677","GSM2098637","GSM2098640","GSM2098638","GSM2098746","GSM2098635","GSM2098669","GSM2098736","GSM2098636","GSM2098734","GSM2098665","GSM2098742","GSM2098678","GSM2098679","GSM2098713","GSM2098756","GSM2098751","GSM2098720","GSM2098644","GSM2098651","GSM2098733","GSM2098634","GSM2098680","GSM2098639","GSM2098714","GSM2098702","GSM2098643","GSM2098653",
"GSM2098647","GSM2098694","GSM2098732","GSM2098739","GSM2098754","GSM2098682","GSM2098631","GSM2098672","GSM2098709","GSM2098658","GSM2098663","GSM2098670","GSM2098674","GSM2098725","GSM2098731","GSM2098722","GSM2098726","GSM2098752","GSM2098684","GSM2098717","GSM2098630","GSM2098656","GSM2098654","GSM2098721","GSM2098757","GSM2098675","GSM2098699","GSM2098723","GSM2098707","GSM2098708",
"GSM2098652","GSM2098716","GSM2098755","GSM2098649","GSM2098704","GSM2098664","GSM2098673","GSM2098711","GSM2098703","GSM2098706","GSM2098738","GSM2098660","GSM2098686","GSM2098724","GSM2098661","GSM2098659","GSM2098668","GSM2098655","GSM2098697","GSM2098696","GSM2098691","GSM2098650","GSM2098718","GSM2098741","GSM2098753","GSM2098705","GSM2098646","GSM2098693","GSM2098690","GSM2098657",
"GSM2098688","GSM2098692","GSM2098701","GSM2098648","GSM2098645","GSM2098689","GSM2098698","GSM2098687","GSM2098700","GSM2098662","GSM2098685","GSM2098633","GSM2126065","GSM2407543","GSM2126067","GSM2407547","GSM2126066","GSM2126070","GSM2126064","GSM2407544","GSM2126072","GSM2126071","GSM2407548","GSM2126068","GSM2126063","GSM2407546","GSM2126069","GSM2126073","GSM2126074","GSM2407545",
"GSM2192700","GSM2192665","GSM2192653","GSM2192684","GSM2192664","GSM2192660","GSM2192678","GSM2192702","GSM2192650","GSM2192658","GSM2192701","GSM2192686","GSM2192655","GSM2192654","GSM2192669","GSM2192682","GSM2192675","GSM2192667","GSM2192672","GSM2192695","GSM2192704","GSM2192670","GSM2192693","GSM2192663","GSM2192689","GSM2192651","GSM2192666","GSM2192676","GSM2192674","GSM2192696",
"GSM2192706","GSM2192656","GSM2192685","GSM2192691","GSM2192688","GSM2192698","GSM2192661","GSM2192673","GSM2192657","GSM2192690","GSM2192679","GSM2192677","GSM2192699","GSM2192692","GSM2192662","GSM2192652","GSM2192659","GSM2192668","GSM2192681","GSM2192703","GSM2192648","GSM2192683","GSM2192697","GSM2192694","GSM2192680","GSM2192649","GSM2192671","GSM2192687","GSM2192705","GSM2252626",
"GSM2284968","GSM2252627","GSM2252625","GSM2252624","GSM2284967","GSM2300036","GSM2300033","GSM2300032","GSM2300037","GSM2300035","GSM2300038","GSM2300034","GSM2300039","GSM2330625","GSM2330644","GSM2330645","GSM2330642","GSM2330643","GSM2330623","GSM2330624","GSM2330622","GSM2335759","GSM2335755","GSM2335756","GSM2335754","GSM2335757","GSM2335758","GSM2440280","GSM2440291","GSM2440289",
"GSM2440279","GSM2440282","GSM2440297","GSM2440292","GSM2440281","GSM2440296","GSM2440295","GSM2440278","GSM2440288","GSM2440300","GSM2440285","GSM2440298","GSM2440299","GSM2440283","GSM2440301","GSM2440284","GSM2440294","GSM2440290","GSM2440286","GSM2440287","GSM2440293","GSM2476256","GSM2476257","GSM2476255","GSM2576202","GSM2576189","GSM2576206","GSM2576221","GSM2576198","GSM2576191",
"GSM2576214","GSM2576219","GSM2576216","GSM2576205","GSM2576200","GSM2576220","GSM2576210","GSM2576211","GSM2576209","GSM2576196","GSM2576217","GSM2576199","GSM2576201","GSM2576204","GSM2576203","GSM2576197","GSM2576188","GSM2576222","GSM2576218","GSM2576212","GSM2576213","GSM2576194","GSM2576215","GSM2576207","GSM2576192","GSM2576193","GSM2576195","GSM2576187","GSM2576208","GSM2576190",
"GSM1551969","GSM1551970","GSM1551971","GSM1551972","GSM1551973","GSM1551974","GSM1551975","GSM1551976","GSM1551977","GSM1551978","GSM1551979","GSM1551980","GSM1551981","GSM1551982","GSM1963023","GSM1963024","GSM1963025","GSM1963026","GSM2218826","GSM2218827","GSM2218828","GSM2323834","GSM2323835","GSM2561533","GSM2561534","GSM2561535","GSM2676335","GSM2676336","GSM2676337","GSM2676338",
"GSM2676339","GSM2676340","GSM2676341","GSM2676342","GSM2676343","GSM2676344","GSM2695488","GSM2695489","GSM2695490","GSM2695491","GSM2695492","GSM2695493","GSM2696501","GSM2696502","GSM2696503","GSM2696504","GSM2696505","GSM2696506","GSM2696507","GSM2696508","GSM2696509","GSM2696510","GSM2696511","GSM2696513","GSM2696514","GSM2696515","GSM2696516","GSM2696517","GSM2696518","GSM2696519",
"GSM2696520","GSM2696521","GSM2696522","GSM2696523","GSM2696524","GSM2696525","GSM2696526","GSM2696527","GSM2696528","GSM2696529","GSM2696530","GSM2696531","GSM2696532","GSM2696533","GSM2696534","GSM2696535","GSM2696536","GSM2696537","GSM2696538","GSM2696539","GSM2696540","GSM2696541","GSM2696542","GSM2696544","GSM2696545","GSM2696546","GSM2696547","GSM2696548","GSM2696549","GSM2696551",
"GSM2696552","GSM2696553","GSM2696554","GSM2696555","GSM2696556","GSM2696557","GSM2696558","GSM2696560","GSM2696561","GSM2696562","GSM2696563","GSM2696564","GSM2696565","GSM2696566","GSM2696567","GSM2696568","GSM2696569","GSM2696570","GSM2696571","GSM2696572","GSM2696573","GSM2696574","GSM2696575","GSM2696576","GSM2696577","GSM2696578","GSM2696579","GSM2696580","GSM2696581","GSM2696582",
"GSM2696583","GSM2696584","GSM2696585","GSM2696586","GSM2696587","GSM2696588","GSM2696589","GSM2696590","GSM2696591","GSM2696593","GSM2696594","GSM2696595","GSM2696596","GSM2696597","GSM2696598","GSM2696599","GSM2696601","GSM2696602","GSM2791560","GSM2791561","GSM2791562","GSM2791563","GSM2791564","GSM2791565","GSM2791566","GSM2791567","GSM2791568","GSM2791569","GSM2791570","GSM2791571",
"GSM2791572","GSM2791573","GSM2791574","GSM2791575","GSM2791576","GSM2791577","GSM2791578","GSM2791579","GSM2791580","GSM2791581","GSM2791582","GSM2791583","GSM2791584","GSM2791585","GSM2791586","GSM2791587","GSM2791588","GSM2791589","GSM2791590","GSM2791591","GSM2871734","GSM2871735","GSM2871736","GSM2871737","GSM2871738","GSM2871739","GSM2871740","GSM2871741","GSM2871742","GSM2871743",
"GSM2871744","GSM2871745","GSM2871746","GSM2871747","GSM2871748","GSM2871749","GSM2871750","GSM2871751","GSM2218829","GSM2218830","GSM2218831","GSM2218832","GSM2218833","GSM2218834","GSM2332997","GSM2332998","GSM2332999","GSM2333000","GSM2333001","GSM2333008","GSM2333009","GSM2333019","GSM2333020","GSM2333021","GSM2333022","GSM2333023","GSM2333024","GSM2333025","GSM2333026","GSM2333027",
"GSM2333028","GSM2333029","GSM2333030","GSM2333031","GSM2333032","GSM2443399","GSM2443400","GSM2443401","GSM2443402","GSM2443403","GSM2443404","GSM2443405","GSM2443406","GSM2443407","GSM2443408","GSM2443409","GSM2443410","GSM2712215","GSM2712216","GSM2712217","GSM2712218","GSM2784646","GSM2784647","GSM2784648","GSM2784649","GSM2784650","GSM2784651","GSM2843828","GSM2843829","GSM2843830",
"GSM2843831","GSM2125090","GSM2125091","GSM2125092","GSM2125093","GSM2125094","GSM2125095","GSM2125096","GSM2125097","GSM2670883","GSM2670884","GSM2670885","GSM2670886","GSM2670887","GSM2670888","GSM2787863","GSM2787864","GSM2787865","GSM2787866","GSM2787867","GSM2806798","GSM2806799","GSM2806800","GSM2806801","GSM2806802","GSM2806803","GSM2806804","GSM2806805","GSM2806806","GSM2806807",
"GSM2806808","GSM2806809","GSM2806810","GSM2806811","GSM2806812","GSM2806813","GSM2806814","GSM2806815","GSM2806816","GSM2806817","GSM2806818","GSM2806819","GSM2806820","GSM2806821","GSM2806822","GSM2806823","GSM2806824","GSM2806825","GSM2806826","GSM2806827","GSM2806828","GSM2806829","GSM2806830","GSM2806831","GSM2806832","GSM2806833","GSM2806834","GSM2806835","GSM2806836","GSM2806837",
"GSM2806838","GSM2806839","GSM2806840","GSM2806841","GSM2806842","GSM2806843","GSM2839374","GSM2839375","GSM2839376","GSM2839377","GSM2839378","GSM2839379","GSM2839380","GSM2839381","GSM2977775","GSM2977776","GSM2977777","GSM2977778","GSM2977779","GSM2977780","GSM2977781","GSM2977782","GSM2977783","GSM2977784","GSM1620416","GSM1620417","GSM1620420","GSM1620424","GSM1620425","GSM1620426",
"GSM1620427","GSM1620431","GSM1620433","GSM1620434","GSM1620435","GSM1620437","GSM1620439","GSM1620440","GSM1620442","GSM1620443","GSM1620445","GSM1620447","GSM1620449","GSM1620450","GSM1620452","GSM1620453","GSM1620454","GSM1620456","GSM1620457","GSM1620458","GSM1620460","GSM1620461","GSM1620463","GSM1620464","GSM1620465","GSM1620466","GSM1620467","GSM1620468","GSM1620470","GSM1620471",
"GSM1620472","GSM1620473","GSM1620475","GSM1620477","GSM1620479","GSM1620482","GSM1620483","GSM1620484","GSM1620494","GSM1620498","GSM1620501","GSM1620502","GSM1620503","GSM1620513","GSM1620514","GSM1620515","GSM1620517","GSM1620518","GSM1620519","GSM1620524","GSM1620528","GSM1620529","GSM1620530","GSM1620531","GSM1620535","GSM1620551","GSM1620553","GSM1620554","GSM1620555","GSM1620558",
"GSM1620560","GSM1620562","GSM1620563","GSM1620567","GSM1620569","GSM1620570","GSM1620571","GSM1620572","GSM1620574","GSM1620576","GSM1620577","GSM1620581","GSM1620582","GSM1620585","GSM1620586","GSM1620587","GSM1620589","GSM1620592","GSM1620593","GSM1620595","GSM1620596","GSM1620597","GSM1620599","GSM1620602","GSM1620603","GSM1620606","GSM1620607","GSM1620613","GSM1620621","GSM1620623",
"GSM1620624","GSM1620626","GSM1620629","GSM1620631","GSM1620635","GSM1620636","GSM1620637","GSM1620638","GSM1620640","GSM1620642","GSM1620643","GSM1620645","GSM1620646","GSM1620647","GSM1620649","GSM1620650","GSM1620651","GSM1620654","GSM1620656","GSM1620657","GSM1620658","GSM1620659","GSM1620660","GSM1620661","GSM1620662","GSM1620665","GSM1620668","GSM1620669","GSM1620670","GSM1620675",
"GSM1620679","GSM1620681","GSM1620683","GSM1620684","GSM1620688","GSM1620690","GSM1620691","GSM1620692","GSM1620694","GSM1620698","GSM1620704","GSM1620705","GSM1620707","GSM1620713","GSM1620716","GSM1693047","GSM1693048","GSM1693049","GSM1693050","GSM1693051","GSM1693052","GSM1693053","GSM1693054","GSM1693055","GSM1693056","GSM2124708","GSM2124709","GSM2124710","GSM2124711","GSM2124712",
"GSM2124713","GSM2124714","GSM2124715","GSM2124716","GSM2124717","GSM2131183","GSM2131184","GSM2131185","GSM2131186","GSM2179001","GSM2179002","GSM2179003","GSM2179004","GSM2179005","GSM2179006","GSM2179007","GSM2179008","GSM2179009","GSM2179010","GSM2179011","GSM2179012","GSM2179013","GSM2179014","GSM2179015","GSM2179016","GSM2227407","GSM2227408","GSM2227409","GSM2227410","GSM2300040",
"GSM2300041","GSM2300042","GSM2300043","GSM2330630","GSM2330631","GSM2330632","GSM2330633","GSM2330634","GSM2330635","GSM2330636","GSM2330637","GSM2330638","GSM2330639","GSM2330640","GSM2330641","GSM2330646","GSM2330647","GSM2330648","GSM2330649","GSM2330650","GSM2330651","GSM2330652","GSM2330653","GSM2330654","GSM2330655","GSM2330656","GSM2330657","GSM2330658","GSM2330659","GSM2330660",
"GSM2330661","GSM2333002","GSM2333003","GSM2333004","GSM2333005","GSM2333006","GSM2333007","GSM2333010","GSM2333011","GSM2333012","GSM2333013","GSM2333014","GSM2333015","GSM2333016","GSM2333017","GSM2333018","GSM2333033","GSM2333034","GSM2333035","GSM2333036","GSM2333037","GSM2443397","GSM2443398","GSM2454730","GSM2454731","GSM2454732","GSM2454733","GSM2454734","GSM2454735","GSM2454736",
"GSM2454737","GSM2454738","GSM2454739","GSM2454740","GSM2454741","GSM2670874","GSM2670875","GSM2670876","GSM2670877","GSM2670878","GSM2670879","GSM2670880","GSM2670881","GSM2670882","GSM2895237","GSM2895238","GSM2895239","GSM2895240","GSM2895241","GSM2895242","GSM2895243","GSM2895244","GSM2895245","GSM2895246","GSM2895247","GSM2895248","GSM2915403","GSM2915404","GSM2915405","GSM2915406",
"GSM2915407","GSM2915408","GSM2915409","GSM2915410","GSM2915411","GSM2915412","GSM2915413","GSM2915414","GSM2130384","GSM2130385","GSM2130386","GSM2130387","GSM2130388","GSM2130389","GSM2130390","GSM2130391","GSM2130392","GSM2130393","GSM2130394","GSM2130395","GSM2130396","GSM2130397","GSM2130398","GSM2130399","GSM2130400","GSM1626701","GSM1626702","GSM1626703","GSM1626704","GSM1626705",
"GSM1626706","GSM2645630","GSM2645631","GSM2645632","GSM2645633","GSM2645634","GSM2645635","GSM2645636","GSM2645637","GSM2645638","GSM2645639","GSM2645640","GSM2645641","GSM2645642","GSM2645643","GSM2645644","GSM2645645","GSM2705901","GSM2705902","GSM2705903","GSM2705904","GSM2788349","GSM2788350","GSM2788351","GSM3028444","GSM3028492","GSM3106217","GSM3106218","GSM3106219","GSM3106220",
"GSM3106221","GSM3106222","GSM3106223","GSM3106224","GSM3106225","GSM3106226","GSM3106227","GSM3106228","GSM3106229","GSM3106230","GSM3106231","GSM3106232","GSM3127583","GSM3127584","GSM3127585","GSM3127586","GSM3127587","GSM3127588","GSM3127589","GSM3127590","GSM3127591","GSM3127592","GSM3127593","GSM3127594","GSM3127595","GSM3127596","GSM3127597","GSM3127598","GSM3127599","GSM3127600",
"GSM3127601","GSM3127602","GSM3127603","GSM3127604","GSM3127605","GSM3141012","GSM3141013","GSM3141014","GSM2425620","GSM2425621","GSM2425622","GSM2425623","GSM2741793","GSM2741794","GSM2741795","GSM2741796","GSM2741797","GSM2741798","GSM2741799","GSM2741800","GSM2741801","GSM2741802","GSM2741803","GSM2741804","GSM2758943","GSM2758944","GSM2758946","GSM2758947","GSM2758948","GSM2758949",
"GSM2758950","GSM2758951","GSM2758952","GSM2758954","GSM2046892","GSM2046893","GSM2046894","GSM2046895","GSM2046896","GSM2255508","GSM2255509","GSM2255510","GSM2255511","GSM2255512","GSM2255513","GSM2255514","GSM2255515","GSM2255516","GSM2255517","GSM2255518","GSM2255519","GSM2255520","GSM2255521","GSM2255522","GSM2255523","GSM2255524","GSM2255525","GSM2255526","GSM2255527","GSM2255528",
"GSM2255529","GSM2255530","GSM2255531","GSM2255532","GSM2255533","GSM2255534","GSM2255535","GSM2255536","GSM2255537","GSM2255538","GSM2255539","GSM2255540","GSM2255541","GSM2255542","GSM2255543","GSM2668081","GSM2668082","GSM2668083","GSM2668084","GSM2668086","GSM2668088","GSM2668089","GSM2741787","GSM2741788","GSM2741789","GSM2741790","GSM2741791","GSM2741792","GSM2650110","GSM2650112",
"GSM2650113","GSM2650116","GSM2650117","GSM2650118","GSM2650119","GSM2650121","GSM2650122","GSM2650123","GSM3014940","GSM3014941","GSM3014942","GSM3014943","GSM3014944","GSM3014945","GSM1574792","GSM1574794","GSM1574795","GSM1574796","GSM1574798","GSM1574800","GSM1574801","GSM1574802","GSM1574803","GSM1574804","GSM1574805","GSM1574806","GSM1574807","GSM1574808","GSM1847015","GSM1847016",
"GSM1847019","GSM1847020","GSM1944515","GSM1944516","GSM1944518","GSM1944519","GSM1944520","GSM1944521","GSM1944523","GSM2028919","GSM2028920","GSM2028921","GSM2028922","GSM2028923","GSM2028924","GSM2285709","GSM2285710","GSM2285711","GSM2285713","GSM2285714","GSM2714336","GSM2714337","GSM2714339","GSM2714340","GSM2714341","GSM2714343","GSM2714344","GSM2714345","GSM2714346","GSM2714347",
"GSM2714348","GSM2714349","GSM2714350","GSM2714351","GSM2714352","GSM2714353","GSM2714354","GSM2714355","GSM2729076","GSM2729077","GSM2729078","GSM2729079","GSM2729080","GSM3106718","GSM3106720","GSM3106723","GSM3106725","GSM3106726","GSM3106727","GSM3106729","GSM3106730","GSM3106733","GSM3106735","GSM3106736","GSM1257869","GSM1257874","GSM1257876","GSM1257877","GSM2286183","GSM2286185",
"GSM2860200","GSM1334453","GSM1334454","GSM1334456","GSM1334460","GSM1334461","GSM2631372","GSM2631373","GSM2631374","GSM2649273","GSM2649275","GSM2649276","GSM2649277","GSM2649278","")

    # Retrieve information from compressed data
    samples = h5read(destination_file, "meta/Sample_geo_accession")
    tissue = h5read(destination_file, "meta/Sample_source_name_ch1")
    genes = h5read(destination_file, "meta/genes")

    # Identify columns to be extracted
    sample_locations = which(samples %in% samp)

    # extract gene expression from compressed data
    expression = h5read(destination_file, "data/expression", index=list(1:length(genes), sample_locations))
    H5close()
    rownames(expression) = genes
    colnames(expression) = samples[sample_locations]

    # Print file
    write.table(expression, file=extracted_expression_file, sep="\t", quote=FALSE)
    print(paste0("Expression file was created at ", getwd(), "/", extracted_expression_file))
}
